<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Időjárás Előrejelző</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    /* Full-screen forecast result style */
    #forecastResult {
      display: none;
      height: 100vh;
      width: 100%;
      padding-top: 50px;
      text-align: center;
      color: white;
    }
    /* Custom background colors for each weather type */
    .napos-bg { background-color: #f1c40f; }      /* Sunny: yellow */
    .borult-bg { background-color: #95a5a6; }      /* Cloudy: grey */
    .esos-bg   { background-color: #3498db; }      /* Rainy: blue */
    .havas-bg  { background-color: #bdc3c7; }      /* Snowy: light grey */
    
    /* Weather icon styling */
    .weather-icon {
      max-width: 150px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container my-4">
    <h1 class="mb-4">Időjárás Előrejelző</h1>
    
    <!-- Section for adding past weather data -->
    <div class="mb-3">
      <label for="weatherSelect">Válassz időjárási típust az elmúlt nap számára:</label>
      <select class="form-control w-50" id="weatherSelect">
        <option value="0">Napos</option>
        <option value="1">Borult</option>
        <option value="2">Esos</option>
        <option value="3">Havas</option>
      </select>
      <button onclick="createWeather()" id="addWeatherBtn" class="btn btn-primary mt-2">Add Past Weather</button>
    </div>
    
    <!-- List of past weather data -->
    <div class="mb-3">
      <h4>Past Weather Data</h4>
      <ul id="pastWeatherList" class="list-group">
        <!-- List items will be added here -->
      </ul>
    </div>
    
    <!-- Button to trigger forecast creation -->
    <button id="createForecastBtn" class="btn btn-success">Create Forecast</button>
  </div>
  
  <!-- Full-screen display for the forecast result -->
  <div id="forecastResult" class="d-flex flex-column justify-content-center align-items-center">
    <img id="weatherIcon" class="weather-icon" src="" alt="Weather Icon">
    <h2 id="forecastType"></h2>
    <h3 id="temperature"></h3>
    <h4 id="windSpeed"></h4>
    <button id="backBtn" class="btn btn-light mt-4">Back</button>
  </div>
  
  <script>
    // Array to store the past weather types (strings matching the enum names)
    let pastWeatherArray = [];
    
    

    // Update the displayed list of past weather entries
    function updatePastWeatherList() {
      const list = document.getElementById("pastWeatherList");
      list.innerHTML = '';
      pastWeatherArray.forEach((weather, index) => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.textContent = `Day ${index + 1}: ${weather}`;
        list.appendChild(li);
      });
    }


    function createWeather() {
    let type = document.querySelector('#weatherSelect').value

    fetch('http://localhost:5067/WeatherForecast/forecast',{
        method: 'POST',
        headers: { 'Content-Type' : 'application/json' },
        body: JSON.stringify({
            type: type
        })
    })
    .then(resp => {
        console.log('Response: ', resp)
        if(resp.status === 200) {
            updatePastWeatherList()
        }
    })
    .catch(error => console.log(error))
}
    
    
    
    // Event: "Create Forecast" button click
    document.getElementById("createForecastBtn").addEventListener("click", () => {
      if (pastWeatherArray.length === 0) {
        alert("Kérlek adj meg legalább egy időjárási adatot az elmúlt nap(ok)hoz.");
        return;
      }
      
      // Prepare the payload for the POST request
      // Each entry is an object with "weatherType" property.
      const payload = pastWeatherArray.map(item => ({ weatherType: item }));
      console.log(payload)

      fetch("http://localhost:5067/WeatherForecast/forecast", {  // Adjust the URL/port if needed
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then(data => {
        // Display forecast result using the data returned.
        displayForecast(data);
        // Optionally, add the forecasted weather to the past weather list
        if (data.weatherType) {
          pastWeatherArray.push(data.weatherType);
          updatePastWeatherList();
        }
      })
      .catch(error => {
        console.error("Error creating forecast:", error);
        alert("Error creating forecast");
      });
    });
    
    // Function to display the forecast result in full screen.
    function displayForecast(data) {
      const forecastDiv = document.getElementById("forecastResult");
      const forecastTypeEl = document.getElementById("forecastType");
      const temperatureEl = document.getElementById("temperature");
      const windSpeedEl = document.getElementById("windSpeed");
      const weatherIconEl = document.getElementById("weatherIcon");
      
      forecastTypeEl.textContent = "Időjárás: " + data.weatherType;
      temperatureEl.textContent = "Hőmérséklet: " + data.temperature + "°C";
      windSpeedEl.textContent = "Szélsebesség: " + data.windSpeed + " km/h";
      
      // Determine the appropriate background class and icon source based on the forecast
      let bgClass = "";
      let iconSrc = "";
      switch (data.weatherType) {
        case "Napos":
          bgClass = "napos-bg";
          iconSrc = "images/napos.png";
          break;
        case "Borult":
          bgClass = "borult-bg";
          iconSrc = "images/borult.png";
          break;
        case "Esos":
          bgClass = "esos-bg";
          iconSrc = "images/esos.png";
          break;
        case "Havas":
          bgClass = "havas-bg";
          iconSrc = "images/havas.png";
          break;
        default:
          bgClass = "";
          iconSrc = "";
          break;
      }
      
      // Set the background class and update the icon source
      forecastDiv.className = "d-flex flex-column justify-content-center align-items-center " + bgClass;
      weatherIconEl.src = iconSrc;
      
      // Hide the main container and display the forecast result
      document.querySelector(".container").style.display = "none";
      forecastDiv.style.display = "flex";
    }
    
    // Event: "Back" button to return to the main interface.
    document.getElementById("backBtn").addEventListener("click", () => {
      document.getElementById("forecastResult").style.display = "none";
      document.querySelector(".container").style.display = "block";
    });
  </script>
</body>
</html>
